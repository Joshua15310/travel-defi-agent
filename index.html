<script>
        // --- 1. Robust Thread ID Generation ---
        // This works on ALL browsers and file locations
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
        
        const threadId = generateUUID();
        console.log("Using Thread ID:", threadId); // <--- Check your browser console for this!

        // 2. Point to your Render URL
        const AGENT_URL = "https://crypto-defi-agent.onrender.com/agent/invoke";

        function handleEnter(e) {
            if (e.key === "Enter") sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById("userInput");
            const text = input.value.trim();
            if (!text) return;

            addMessage(text, "user");
            input.value = "";
            setLoading(true);

            // --- 3. Construct Payload ---
            // This is the EXACT format LangGraph needs
            const payload = {
                input: {
                    messages: [{ content: text, type: "human" }]
                },
                config: {
                    configurable: {
                        thread_id: threadId
                    }
                }
            };

            console.log("Sending Payload:", JSON.stringify(payload)); // <--- Debug print

            try {
                const response = await fetch(AGENT_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errText = await response.text();
                    throw new Error(`Server Error: ${response.status} - ${errText}`);
                }

                const data = await response.json();
                
                let lastMsg = "No response content.";
                if (data.output && data.output.messages && data.output.messages.length > 0) {
                    const msgs = data.output.messages;
                    lastMsg = msgs[msgs.length - 1].content;
                }
                
                addMessage(lastMsg, "agent");

            } catch (error) {
                addMessage("‚ùå Error: " + error.message, "agent");
                console.error(error);
            } finally {
                setLoading(false);
            }
        }

        function addMessage(text, sender) {
            const chat = document.getElementById("chat");
            const div = document.createElement("div");
            div.className = `message ${sender}`;
            div.textContent = text;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function setLoading(isLoading) {
            document.getElementById("loader").style.display = isLoading ? "block" : "none";
            document.getElementById("userInput").disabled = isLoading;
            document.getElementById("sendBtn").disabled = isLoading;
        }
    </script>